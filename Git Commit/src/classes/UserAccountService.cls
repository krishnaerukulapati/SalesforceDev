@RestResource(urlMapping='/UserService/*')
global with sharing class UserAccountService
{

	@HttpGet
	global static User doGet() {
		//https://stjecc-dev.cs7.my.salesforce.com/services/apexrest/UserService
		RestRequest req = RestContext.request;
		RestResponse res = RestContext.response;
		String userId = RestContext.request.params.get('userid');
		User result = [SELECT Id, Email, Name
						FROM User 
						WHERE Id = :userId];
		return result;
	}

	@HttpPost
	global static String checkUser(String email, String firstName, String lastName) {
		RestRequest req = RestContext.request;
		RestResponse res = RestContext.response;
		//String email = RestContext.request.params.get('email');
		//check if user exists already
		User userExists = [SELECT Id 
						FROM User
						WHERE FederationIdentifier = :email];

		if (userExists == null){
			//return error?
		}
		else {
			//might refactor to be in createNewUser();  Will need logic to determine some of these fields
			User user = new User();
			user.isactive = true;
			user.username = null; //have to generate this (different based on environment)
			user.lastname = lastName;
			user.firstName = firstName;
			//user.name = firstName + ' ' + lastName; seems to auto generate this
			user.federationidentifier = email; //This is their single sign up info
			user.email = email;
			user.division = null;
			user.department = null;
			user.title = null;
			user.alias = null; //Also might be autogenerated
			//user.profile = (Is a lookup field, needs to be profiles assigned Id);
			//The below fields are unknown on how they get generated, but they had values
			//user.EMAILPREFERENCESAUTOBCC = true;
			//user.EMAILPREFERENCESSTAYINTOUCHREMINDER = true;
			//user.COMMUNITYNICKNAME = 'somevalue';
			//user.TIMEZONESIDKEY = 'America/Chicago';
			//user.LOCALESIDKEY = 'en_US';
			//user.RECEIVESINFOEMAILS = true;
			//user.RECEIVESADMININFOEMAILS = true;



		}
		
		string result = 'Successfully create user ' + user.username + '.  Their SalesForceâ„¢ Id is: ' + user.id;
		return result;
	}

	private static User createNewUser(){
		User newUser = new User();

		return newUser;
	}

}